{% load static %}
<html>
    <head>
        <title> User Report</title>
        <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <link rel="stylesheet" href="{% static 'User/css/vendor.css' %}">
        <link rel="stylesheet" href="{% static 'User/css/styles.css' %}">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    </head>
    <style>
        body{
            background-color : black;           /* Background color changed */
            font-family: 'Orbitron', sans-serif;  /* Body fonts */
            color: white;                       /* Text color */
        }   

        .kanit-regular {
        font-family: "Kanit", sans-serif;
        font-weight: 400;
        font-style: normal;
        }

        ul {
         list-style-type: none; /* Removes bullet points */
         padding: 0;            /* Optional: removes default padding */
         margin: 0;             /* Optional: removes default margin */
      }

      .container {
         display: flex;
         width: 100vw; /* Full window width */
      }

      /* Style for each column */
      .column {
         flex: 1; /* Equal width for each column */
         padding: 20px;
         color: #ffffff; /* Text color */
         border: 2px solid #333; /* Border color and thickness */
         background-color: transparent; /* Transparent background */
         box-sizing: border-box; /* Include padding and border in width */
      }

      .highcharts-figure,
.highcharts-data-table table {
    min-width: 310px;
    max-width: 800px;
    margin: 1em auto;
}

#container {
    height: 400px;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid #ebebeb;
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}

.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: #555;
}

.highcharts-data-table th {
    font-weight: 600;
    padding: 0.5em;
}

.highcharts-data-table td,
.highcharts-data-table th,
.highcharts-data-table caption {
    padding: 0.5em;
}

.highcharts-data-table thead tr,
.highcharts-data-table tr:nth-child(even) {
    background: #f8f8f8;
}

.highcharts-data-table tr:hover {
    background: #f1f7ff;
}

.highcharts-description {
    margin: 0.3rem 10px;
}

.highcharts-figure,
  .highcharts-data-table table {
      min-width: 320px;
      max-width: 800px;
      margin: 1em auto;
  }

  .highcharts-data-table table {
      font-family: Verdana, sans-serif;
      border-collapse: collapse;
      border: 1px solid #ebebeb;
      margin: 10px auto;
      text-align: center;
      width: 100%;
      max-width: 500px;
  }

  .highcharts-data-table caption {
      padding: 1em 0;
      font-size: 1.2em;
      color: #555;
  }

  .highcharts-data-table th {
      font-weight: 600;
      padding: 0.5em;
  }

  .highcharts-data-table td,
  .highcharts-data-table th,
  .highcharts-data-table caption {
      padding: 0.5em;
  }

  .highcharts-data-table thead tr,
  .highcharts-data-table tr:nth-child(even) {
      background: #f8f8f8;
  }

  .highcharts-data-table tr:hover {
      background: #f1f7ff;
  }

  input[type="number"] {
      min-width: 50px;
  }

  .highcharts-description {
      margin: 0.3rem 10px;
  }

  * {
    font-family: Helvetica, Arial, sans-serif;
}

#container {
    height: 400px;
}

.highcharts-figure,
.highcharts-data-table table {
    min-width: 310px;
    max-width: 800px;
    margin: 1em auto;
}

#sliders {
    margin: 0.3rem 10px;
}

#sliders td input[type="range"] {
    display: inline;
}

#sliders td {
    padding-right: 1em;
    white-space: nowrap;
}

.highcharts-description {
    margin: 0.3rem 10px;
}



.highcharts-figure,
.highcharts-data-table table {
    min-width: 320px;
    max-width: 660px;
    margin: 1em auto;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid #ebebeb;
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}

.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: #555;
}

.highcharts-data-table th {
    font-weight: 600;
    padding: 0.5em;
}

.highcharts-data-table td,
.highcharts-data-table th,
.highcharts-data-table caption {
    padding: 0.5em;
}

.highcharts-data-table thead tr,
.highcharts-data-table tr:nth-child(even) {
    background: #f8f8f8;
}

.highcharts-data-table tr:hover {
    background: #f1f7ff;
}

.highcharts-description {
    margin: 0.3rem 10px;
}

* {
    font-family: Helvetica, Arial, sans-serif;
}

#container {
    height: 400px;
}

.highcharts-figure,
.highcharts-data-table table {
    min-width: 310px;
    max-width: 800px;
    margin: 1em auto;
}

#sliders {
    margin: 0.3rem 10px;
}

#sliders td input[type="range"] {
    display: inline;
}

#sliders td {
    padding-right: 1em;
    white-space: nowrap;
}

.highcharts-description {
    margin: 0.3rem 10px;
}

    </style>

        <style>
        /* Customize the content inside the print page */
        @media print {
            body {
                font-family: Arial, sans-serif;
                color: black;
                background: white;
            }
        }
    </style>

<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/cylinder.js"></script>
<script src="https://code.highcharts.com/highcharts-3d.js"></script>
<script src="https://code.highcharts.com/modules/data.js"></script>
<script src="https://code.highcharts.com/modules/drilldown.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>

    <body>
        <header>
            <div class="s-header__logo">
                <a class="logo" href="{% url 'index' %}">
                    <img src="/static/User/images/logo.svg" height="60px" width="60px" alt="Homepage">
                </a>
            </div>
            <center>
                <h1 class="s-intro__pretitle"><span style="color:hsla(37, 95%, 47%, 1);">AuraSync</span></h1>
                <h1 class="s-intro__pretitle kanit-regular">User emotion report</h1>
            </center>
        </header>

        <div class="container">
            <div class="column"><ul>
                <li><b>First Name : </b>{{ user.first_name }}</li>
                <li><b>Last Name : </b>{{ user.last_name }}</li>
                <li><b>User Id : </b>{{ user.id }}</li>
            </ul></div>
            <div class="column"><ul>
                <li><b>Email : </b>{{ user.email }}</li>
                <li><b>Date Of Birth : </b>{{ user_details.dob }}</li>
                <li><b>Age : </b>{{ user_details.age }}</li>
            </ul></div>
            <div class="column"><ul>
                <li><b>Phone Number : </b>{{ user_details.phone_number }}</li>
                <li><b>Gender : </b>{{ user_details.gender }}</li>
                <li><b>State : </b>{{ user_details.state }}</li>
            </ul></div>
         </div>

                <container>
                    <center><h3 style="color:white;">Today's emotions count</h3></center>
                    <figure class="highcharts-figure">
                        <div id="container"></div>
                            <p class="highcharts-description">
                                This graph shows the amount of the user's emotion. The different bars in the graphs represents different emotions as mentioned below each of them.
                            </p>
                        </figure>
                </container>

                <container>
                    <center><h3 style="color:white;">Today's emotions propotion</h3></center>
                    <figure class="highcharts-figure">
                        <div id="container2"></div>
                            <p class="highcharts-description">
                                    This pie chart shows the proposion of the user emotion in percentages.
                            </p>
                    </figure>
                </container>



            <center><h3 style="color:white;"> Overall Emotion Analysis </h3></center>
                <figure class="highcharts-figure">
                    <div id="container3"></div>
                        <p class="highcharts-description">
                            This 3D column chart shows the  overall emotion behaviour of the user. Each label under x-axis shows the emotion label.
                        </p>
                <figure>
<br>
<br>
                <center><button class="next-btn" id="printDownloadBtn">Print & Download PDF</button></center>


        


        
        

<script>
    Highcharts.chart("container2", {
  chart: {
    type: "pie",
  },
  title: {
    text: "Emotion propotion",
  },
  tooltip: {
    valueSuffix: "%",
  },
  subtitle: {
    text: "Today's Report",
  },
  plotOptions: {
    series: {
      allowPointSelect: true,
      cursor: "pointer",
      dataLabels: [
        {
          enabled: true,
          distance: 20,
        },
        {
          enabled: true,
          distance: -40,
          format: "{point.percentage:.1f}%",
          style: {
            fontSize: "1.2em",
            textOutline: "none",
            opacity: 0.7,
          },
          filter: {
            operator: ">",
            property: "percentage",
            value: 10,
          },
        },
      ],
    },
  },
  series: [
    {
      name: "Percentage",
      colorByPoint: true,
      data: [
        {% for emotion in Highcharts_data %}
            {
                name: '{{ emotion.emotion_label }}',
                y: {{ emotion.count }}/{{ total_emotion_count }},
                }{% if not forloop.last %},{% endif %}
        {% endfor %}
        // {
        //   name: "Fat",
        //   sliced: true,
        //   selected: true,
        //   y: 26.71,
        // },
        // {
        //   name: "Carbohydrates",
        //   y: 1.09,
        // },
        // {
        //   name: "Protein",
        //   y: 15.5,
        // },
        // {
        //   name: "Ash",
        //   y: 1.68,
        // },
      ],
    },
  ],
})
</script>

<script>

        Highcharts.chart('container', {
            chart: {
                type: 'column'
            },
            title: {
                align: 'left',
                text: 'Total Emotion Analysis'
            },

            accessibility: {
                announceNewData: {
                    enabled: true
                }
            },
            xAxis: {
                type: 'category'
            },
            yAxis: {
                title: {
                    text: 'Total Count of daily emotion.'
                }
        
            },
            legend: {
                enabled: false
            },
            plotOptions: {
                series: {
                    borderWidth: 0,
                    dataLabels: {
                        enabled: true,
                        format: '{point.y:.1f}'
                    }
                }
            },
        
            tooltip: {
                headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                pointFormat: '<span style="color:{point.color}">{point.name}</span>: ' +
                    '<b>{point.y:.2f}%</b> of total<br/>'
            },
        
            series: [
                {
                    
                    name: 'Emotions',
                    colorByPoint: true,
                    data: [
                    {% for emotion in Highcharts_data %}
                        {
                            name: '{{ emotion.emotion_label }}',
                            y: {{ emotion.count }},
                            drilldown: '{{ emotion.emotion_label }}'
                        }{% if not forloop.last %},{% endif %}
                    {% endfor %}
                        // {
                        //     name: 'Safari',
                        //     y: 19.84,
                        //     drilldown: 'Safari'
                        // },
                        // {
                        //     name: 'Firefox',
                        //     y: 4.18,
                        //     drilldown: 'Firefox'
                        // },
                        // {
                        //     name: 'Edge',
                        //     y: 4.12,
                        //     drilldown: 'Edge'
                        // },
                        // {
                        //     name: 'Opera',
                        //     y: 2.33,
                        //     drilldown: 'Opera'
                        // },
                        // {
                        //     name: 'Internet Explorer',
                        //     y: 0.45,
                        //     drilldown: 'Internet Explorer'
                        // },
                        // {
                        //     name: 'Other',
                        //     y: 1.582,
                        //     drilldown: null
                        // }
                    ]
                }
            ]
        });
        </script>

        <script>
        
// Set up the chart
const chart = new Highcharts.Chart({
    chart: {
        renderTo: 'container3',
        type: 'column',
        options3d: {
            enabled: true,
            alpha: 15,
            beta: 15,
            depth: 50,
            viewDistance: 25
        }
    },
    xAxis: {
        type: 'category'
    },
    yAxis: {
        title: {
            enabled: false
        }
    },
    tooltip: {
        headerFormat: '<b>{point.key}</b><br>',
        pointFormat: 'Cars sold: {point.y}'
    },
    title: {
        text: 'Overall emotion analysis',
        align: 'left'
    },
    subtitle: {
        text: 'Overall analysis',
        align: 'left'
    },
    legend: {
        enabled: false
    },
    plotOptions: {
        column: {
            depth: 25
        }
    },
    series: [{
        data: [
            {% for emotion in all_emotions %}
                        {
                            name: '{{ emotion.emotion_label }}',
                            y: {{ emotion.count }},
                            drilldown: '{{ emotion.emotion_label }}'
                        }{% if not forloop.last %},{% endif %}
                    {% endfor %}
        ],
        colorByPoint: true
    }]
});

function showValues() {
    document.getElementById(
        'alpha-value'
    ).innerHTML = chart.options.chart.options3d.alpha;
    document.getElementById(
        'beta-value'
    ).innerHTML = chart.options.chart.options3d.beta;
    document.getElementById(
        'depth-value'
    ).innerHTML = chart.options.chart.options3d.depth;
}

// Activate the sliders
document.querySelectorAll(
    '#sliders input'
).forEach(input => input.addEventListener('input', e => {
    chart.options.chart.options3d[e.target.id] = parseFloat(e.target.value);
    showValues();
    chart.redraw(false);
}));

showValues();

</script>

    <script>
        document.getElementById("printDownloadBtn").addEventListener("click", function() {
            // Print the page
            window.print(); // Open print dialog

            // Create PDF after a slight delay to allow print dialog to open
            setTimeout(function() {
                const { jsPDF } = window.jspdf;  // Get jsPDF class
                const doc = new jsPDF();

                // Capture the HTML content and add it to the PDF
                doc.html(document.body, {
                    callback: function (doc) {
                        doc.save("analysis_report.pdf");  // Save the file as PDF
                    },
                    margin: [10, 10, 10, 10],  // Optional margin
                    x: 10,
                    y: 10
                });
            }, 1000); // 1-second delay to prevent print dialog interruption
        });
    </script>
        


    </body>
    </html>